<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Olympus App</title>
    <link rel="shortcut icon" href="imgs/favicon.png" type="image/x-icon">
    <link rel="stylesheet" href="css/padrao.css">
    <link rel="stylesheet" href="css/cadastro-login.css">
</head>

<!--
O site tem como objetivo auxiliar pessoas a monitorar seus treinos, alimentação e progresso físico, proporcionando uma experiência prática e eficiente para melhorar o desempenho na academia. Em um único lugar, o usuário pode controlar sua dieta, estabelecer metas de peso e acompanhar medidas corporais, promovendo saúde, disciplina e evolução diária.
Após realizar o login, é possível iniciar treinos, registrar informações, buscar registros anteriores e deslogar da conta de forma simples. A plataforma oferece controle centralizado da rotina de treinos e alimentação, permitindo um acompanhamento visual e organizado do progresso, com fácil acesso e uso, tornando a experiência completa e motivadora.

A disciplina constroi o corpo e a mente e lapida a alma
-->

<body>
    <div>
        <header>
            <h1>Olympus App</h1>
        </header>
        <h1 style="margin-bottom: 120px; font-size: 30px;">Log In</h1>
            <form id="loginForm">
                <input type="email" id="login" name="login" placeholder="Email" required>
                <div class="password-wrapper">
                    <input type="password" id="password" name="password" placeholder="Senha" required>
                    <img id="togglePassword" class="toggle-eye" src="icons/olho-fechado.png" alt="Mostrar senha" title="Mostrar senha">
                </div>
                <input class="input-submit" type="submit" value="Login">
            </form>
            <a href="#">Esqueci a senha</a>
            <p>Novo no Olympus? <a href="cadastro.html">Cadastre-se</a></p>
    </div>
    <script src="javascript/scripts.js"></script>
    <script>
document.getElementById("loginForm").addEventListener("submit", async function(e) {
    e.preventDefault(); // impede o reload

    const email = document.getElementById("login").value.trim();
    const senha = document.getElementById("password").value.trim();

    if (!email || !senha) {
        alert("Preencha todos os campos!");
        return;
    }

    try {
        const response = await fetch("http://localhost:3000/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email, senha })
        });

        const data = await response.json();

        if (response.status !== 200) {
            alert(data.error || "Erro ao fazer login");
            return;
        }

        // SALVAR DADOS DO USUÁRIO
        localStorage.setItem("usuario", JSON.stringify(data.user));

        alert("Login realizado com sucesso!");

        // REDIRECIONAR
        window.location.href = "index.html";
    } catch (error) {
        console.error(error);
        alert("Erro ao conectar ao servidor.");
    }
});
</script>
</body>
</html>